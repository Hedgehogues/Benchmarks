Разберём три сценария использования протоколов TCP и TTPoE в контексте снижения сетевых задержек в распределённых вычислительных системах:

# Сценарии
1. Передача данных между узлами суперкомпьютера
- TTPoE: Уменьшение задержек за счёт упрощённой установки соединения (двухстороннее "рукопожатие" вместо трёх в TCP) и отказа от состояния TIME_WAIT, что ускоряет открытие и закрытие соединений.
- TCP: Использует трёхэтапное "рукопожатие" для установки соединения (SYN, SYN-ACK, ACK) и состояние TIME_WAIT, что добавляет задержки при частом открытии/закрытии соединений.
2. Управление перегрузками в сети
- TTPoE: Протокол использует статическое окно перегрузки, что сокращает задержки в высококачественных сетях с низкой потерей пакетов. Потерянные пакеты просто переотправляются из буфера.
- TCP: Использует скользящее окно перегрузки, которое динамически меняет размер в зависимости от состояния сети. Это даёт больше гибкости, но добавляет накладные расходы на вычисление размеров окон и контроль состояния сети, что увеличивает задержки.
3. Масштабирование в высоконагруженных дата-центрах
- TTPoE: Протокол реализован на аппаратном уровне и ориентирован на внутренние сети дата-центров, что упрощает масштабирование за счёт низкой аппаратной сложности и способности работать через стандартные Ethernet-коммутаторы.
- TCP: Хотя TCP широко поддерживается, его сложная обработка на уровне ОС и программного обеспечения может становиться узким местом в сильно загруженных системах, особенно когда необходимо масштабироваться до тысяч узлов с минимальной задержкой.

# Отличия TCP и TTPoE
- Работа на уровне IP: TCP работает поверх IP, а TTPoE — поверх Ethernet
- Управление соединением: TCP использует трёхстороннее рукопожатие для установления соединения, в то время как TTPoE использует собственные типы кадров и состояния
- Контроль за перегрузкой и оконное управление: TCP использует механизмы, такие как скользящее окно, для контроля потока данных и предотвращения перегрузки сети
- Надёжная доставка данных: TCP имеет встроенные механизмы для подтверждения (ACK) доставки пакетов и повторной отправки потерянных сегментов

# TTPoE (Tesla Transport Protocol over Ethernet)
## Преимущества
- Минимизация задержек: Протокол ориентирован на сокращение времени ожидания при установке и завершении соединений (упрощённая процедура двухстороннего "рукопожатия", отказ от состояния TIME_WAIT)
- Простота реализации: Протокол упрощён и рассчитан на работу в аппаратном обеспечении, что снижает нагрузку на ЦП и ускоряет обработку данных
Отсутствие сложных алгоритмов контроля перегрузки: TTPoE использует фиксированное окно перегрузки, что упрощает работу и снижает задержки в высококачественных сетях с низкой потерей пакетов
## Компромиссы
- Отсутствие гибкости в условиях потери пакетов: Из-за фиксированного окна перегрузки, протокол плохо работает в сетях с высокой потерей пакетов. В отличие от TCP, который адаптируется к таким условиям, TTPoE просто переотправляет потерянные пакеты, что может привести к снижению производительности в условиях плохой связи
- Ограничение на использование в глобальных сетях: TTPoE ориентирован на внутрицентровые сети с высокой пропускной способностью и низкой задержкой. Он плохо подходит для использования в широких, разнородных и высокозадержечных сетях (например, в Интернете)
Сложность диагностики: Протокол значительно упрощён, что может усложнить диагностику и устранение неполадок в случае сбоев. У TCP есть развитая система диагностики, как, например, возможность использовать инструменты вроде "ping" и "traceroute"

# TCP (Transmission Control Protocol)
## Преимущества
- Гибкость и надёжность: TCP был спроектирован для работы в условиях непредсказуемых сетей, таких как Интернет. Он эффективно управляет потерей пакетов, перегрузками и разными типами соединений, обеспечивая высокую надёжность доставки данных.
Универсальность: TCP широко используется в разнообразных приложениях и сетях. Он подходит как для локальных сетей, так и для глобальных сетей с высокой задержкой, обеспечивая стабильную передачу данных.
- Механизмы контроля потерь: TCP адаптирует размер скользящего окна перегрузки в зависимости от состояния сети, что помогает эффективно работать в условиях высокой потери пакетов.
## Компромиссы
- Высокие накладные расходы: Процедуры "трёхстороннего рукопожатия", управления перегрузками и состояния TIME_WAIT добавляют значительные накладные расходы, что увеличивает задержки, особенно в высокоскоростных, низкозадержечных сетях.
- Сложность реализации: TCP сложен для реализации на аппаратном уровне, что ограничивает его эффективность в системах, где важна быстрая обработка данных, таких как суперкомпьютеры и высокопроизводительные вычислительные центры (HPC).
Медленное завершение соединений: TCP требует множества шагов для завершения соединения, включая отправку подтверждений и ожидание завершения состояния TIME_WAIT, что замедляет обработку при частом открытии и закрытии соединений.

# Главное отличие
- TTPoE жертвует гибкостью и надёжностью в более сложных или перегруженных сетях, чтобы получить минимальные задержки и простоту аппаратной реализации в высококачественных внутрицентровых сетях. Он ориентирован на максимальное упрощение и снижение задержек за счёт оптимизаций в установке соединений и управления перегрузками, что делает его более подходящим для высокоскоростных, низкозадержечных сетей, таких как суперкомпьютеры и AI-центры.
- TCP жертвует скоростью и простотой ради надёжности и универсальности, что делает его более подходящим для работы в различных сетевых условиях, но менее эффективным для приложений с низкой задержкой. Он более универсален и гибок, но более сложен и менее эффективен для сценариев с низкими задержками

# Моделирование
- [TCP](https://github.com/Hedgehogues/Benchmarks/blob/main/code/protocol/tcp.py)
- [TTPoE](https://github.com/Hedgehogues/Benchmarks/blob/main/code/protocol/ttpoe.py)

# Термины
- TCP (Transmission Control Protocol). Протокол транспортного уровня, обеспечивающий надежную передачу данных с подтверждением, управлением потоком и коррекцией ошибок.
- TTPoE (Tesla Transport Protocol over Ethernet). Протокол для быстрой передачи данных поверх Ethernet, обеспечивающий низкие задержки и оптимизацию для высокоскоростных систем.
- FSM (Finite State Machine). Конечный автомат, описывающий поведение системы через различные состояния и события, позволяя управлять сложными последовательностями действий.
- SYN. Сигнальный пакет для начала установления TCP-соединения, первый шаг в процессе трехстороннего рукопожатия.
- ACK. Пакет, подтверждающий успешное получение данных или команд в сетевых протоколах, таких как TCP или TTPoE.
- FIN. Пакет, сигнализирующий о завершении передачи данных и закрытии TCP-соединения.
- TTP_OPEN. Пакет, который используется для инициации соединения в TTPoE.
- Three-Way Handshake (Трехстороннее рукопожатие). Процесс установления соединения в TCP, включающий обмен пакетами SYN, SYN_ACK и ACK.
- Window Size (Оконный размер). Важный параметр TCP для управления потоком данных, определяющий, сколько байтов данных может быть отправлено до получения подтверждения (ACK).
- Rx_seq (Receive Sequence). Номер последовательности принятых данных, который отслеживает, какой объем данных был получен от отправляющей стороны.

# Ссылки
- [opennet.ru](https://www.opennet.ru/opennews/art.shtml?num=61920)
- [TTPoE](https://github.com/teslamotors/ttpoe/)
